# ðŸŽ¯ à¸„à¸§à¸²à¸¡à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: Request Load Flow

## âš ï¸ à¸«à¸¥à¸±à¸à¸à¸²à¸£à¸ªà¸³à¸„à¸±à¸ (Critical)

**Request Load à¹„à¸¡à¹ˆà¸œà¹ˆà¸²à¸™ CCS à¹‚à¸”à¸¢à¸•à¸£à¸‡ à¹à¸•à¹ˆ CLIProxyAPI à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸ˆà¸±à¸”à¸à¸²à¸£à¸«à¸¥à¸±à¸**

```
Client (image_gen.py)
    â†“ Direct HTTP Request
CLIProxyAPI (localhost:8317) â† MAIN REQUEST HANDLER
    â†“ Direct HTTP Request
Google Imagen API

CCS à¸¡à¸µà¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¹€à¸‰à¸žà¸²à¸°à¸•à¸­à¸™ CLIProxyAPI à¸”à¸¶à¸‡ OAuth Token à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
```

---

## ðŸ“Š Request Path à¸­à¸¢à¹ˆà¸²à¸‡à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”

### Path 1: Request Load (Main Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. image_gen.py (Client)                                   â”‚
â”‚     python3 image_gen.py "A cute cat"                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ HTTP POST http://127.0.0.1:8317/v1/chat/completions
                 â”‚ Headers: Authorization: Bearer ccs-internal-managed
                 â”‚ Body: {model, messages, modalities, image_config}
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. CLIProxyAPI (MAIN HANDLER) âœ…                            â”‚
â”‚     localhost:8317                                          â”‚
â”‚                                                             â”‚
â”‚  Request à¸¡à¸²à¸—à¸µà¹ˆà¸™à¸µà¹ˆ â†’ CLIProxyAPI à¸ˆà¸±à¸”à¸à¸²à¸£à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ CLIProxyAPI à¹à¸›à¸¥à¸‡ format à¹à¸¥à¸°à¹€à¸•à¸£à¸µà¸¢à¸¡ call Google
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Google Imagen API                                       â”‚
â”‚     https://generativelanguage.googleapis.com/v1beta/...    â”‚
â”‚                                                             â”‚
â”‚  CLIProxyAPI â†’ Google API (Direct)                          â”‚
â”‚  Google API â†’ CLIProxyAPI (Direct)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ CLIProxyAPI à¹à¸›à¸¥à¸‡ response à¸à¸¥à¸±à¸š
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. CLIProxyAPI â†’ Client                                    â”‚
â”‚     Return base64 image data                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Path 2: Authentication (Side Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIProxyAPI                                                 â”‚
â”‚     à¹€à¸«à¹‡à¸™ "ccs-internal-managed" à¹ƒà¸™ header                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Internal Query (à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ request load)
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CCS (Extension)                                            â”‚
â”‚     ~/.ccs/cliproxy/auth/gemini-*.json                     â”‚
â”‚                                                             â”‚
â”‚  à¸ªà¹ˆà¸‡ OAuth token: ya29.a0Aa7pCA98e...                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ OAuth token à¸à¸¥à¸±à¸šà¸¡à¸²
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIProxyAPI                                                 â”‚
â”‚     à¹ƒà¸Šà¹‰ OAuth token à¹„à¸› call Google API                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”‘ à¸ˆà¸¸à¸”à¸ªà¸³à¸„à¸±à¸à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆ

### Request Load = CLIProxyAPI (Direct)

| à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ | à¸œà¹ˆà¸²à¸™à¹ƒà¸„à¸£ | à¸•à¸±à¸§à¸ˆà¸±à¸”à¸à¸²à¸£ |
|---------|---------|-----------|
| Client â†’ CLIProxyAPI | âœ… Direct | CLIProxyAPI |
| CLIProxyAPI â†’ Google API | âœ… Direct | CLIProxyAPI |
| Google API â†’ CLIProxyAPI | âœ… Direct | CLIProxyAPI |
| CLIProxyAPI â†’ Client | âœ… Direct | CLIProxyAPI |

### CCS = Token Provider Only

| à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ | à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸£ |
|---------|---------|
| CLIProxyAPI à¸•à¹‰à¸­à¸‡à¸à¸²à¸£ token | Query CCS |
| CCS à¸ªà¹ˆà¸‡ token à¸à¸¥à¸±à¸š | CLIProxyAPI à¹„à¸”à¹‰ token |
| Token à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸ | CLIProxyAPI query CCS à¹ƒà¸«à¸¡à¹ˆ |

### CCS à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š Request Load

- âŒ Request à¸ˆà¸²à¸ client à¹„à¸¡à¹ˆà¸œà¹ˆà¸²à¸™ CCS
- âŒ CCS à¹„à¸¡à¹ˆà¹„à¸”à¹‰ process/format request
- âŒ CCS à¹„à¸¡à¹ˆà¹„à¸”à¹‰ call Google API
- âœ… CCS à¸ˆà¸±à¸”à¸à¸²à¸£ OAuth tokens à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™

---

## ðŸ“ à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡

```
         Request Load (Main Flow)
         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client â”‚ â”€â”€â”€â”€â”€â”€>â”‚ CLIProxyAPI â”‚ â”€â”€â”€â”€â”€â”€>â”‚  Google   â”‚
â”‚        â”‚ <â”€â”€â”€â”€â”€â”€ â”‚   (8317)    â”‚ <â”€â”€â”€â”€â”€â”€ â”‚   API     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ Token Query (Side Flow)
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  CCS (Extension) â”‚
                    â”‚                  â”‚
                    â”‚  - Token Storage â”‚
                    â”‚  - Auto-refresh  â”‚
                    â”‚  - OAuth mgmt    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… à¸ªà¸£à¸¸à¸›à¸ªà¸±à¹‰à¸™à¹†

```
Client Request Path:
image_gen.py â†’ CLIProxyAPI â†’ Google API
                (Main Handler)

CCS Role:
à¹€à¸‰à¸žà¸²à¸°à¸•à¸­à¸™ CLIProxyAPI à¸”à¸¶à¸‡ OAuth Token à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š request load à¸ˆà¸²à¸ client
```

**à¸„à¸³à¸ªà¸³à¸„à¸±à¸**: CLIProxyAPI à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸ˆà¸±à¸”à¸à¸²à¸£à¸«à¸¥à¸±à¸à¸‚à¸­à¸‡ request CCS à¹€à¸›à¹‡à¸™à¹€à¸‰à¸žà¸²à¸° token provider à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ ðŸŽ¯
